<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Garansi Rembostore</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Poppins', sans-serif; }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .input-focus:focus {
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
    }
    .extra-fields {
      animation: slideDown 0.3s ease-out;
    }
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .cute-icon {
      display: inline-block;
      margin-right: 6px;
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full gradient-bg overflow-auto">
  <div class="min-h-full py-8 px-4">
   <div class="max-w-lg mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
     <div class="inline-flex items-center justify-center w-20 h-20 bg-white rounded-full shadow-lg mb-4">
      <span class="text-4xl">üõ°Ô∏è</span>
     </div>
     <h1 id="form-title" class="text-2xl md:text-3xl font-bold text-white drop-shadow-lg">FORM GARANSI REMBOSTORE</h1>
     <p class="text-white/80 mt-2 text-sm">Isi form berikut untuk mengaktifkan garansi</p>
    </div><!-- Form Card -->
    <div class="glass-card rounded-3xl shadow-2xl p-6 md:p-8">
     <form id="warranty-form" class="space-y-5">
      <!-- Tanggal Pembelian -->
      <div>
       <label class="block text-sm font-semibold text-gray-700 mb-2"> <span class="cute-icon">üìÖ</span>Tanggal Pembelian </label> <input type="date" id="tanggal-pembelian" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus focus:border-purple-500 outline-none transition-all">
      </div><!-- Durasi Pembelian -->
      <div>
       <label class="block text-sm font-semibold text-gray-700 mb-2"> <span class="cute-icon">‚è±Ô∏è</span>Durasi Pembelian </label> <select id="durasi-pembelian" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus focus:border-purple-500 outline-none transition-all bg-white"> <option value="">Pilih durasi...</option> <option value="1 Minggu">1 Minggu</option> <option value="2 Minggu">2 Minggu</option> <option value="1 Bulan">1 Bulan</option> <option value="2 Bulan">2 Bulan</option> <option value="3 Bulan">3 Bulan</option> <option value="6 Bulan">6 Bulan</option> <option value="1 Tahun">1 Tahun</option> </select>
      </div><!-- Jenis APK Premium -->
      <div>
       <label class="block text-sm font-semibold text-gray-700 mb-2"> <span class="cute-icon">üì±</span>Jenis APK Premium </label> <input type="text" id="jenis-apk" required placeholder="Contoh: Netflix, Vidio, Spotify, dll" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus focus:border-purple-500 outline-none transition-all">
      </div><!-- Extra Fields for Netflix/Vidio -->
      <div id="extra-fields" class="hidden extra-fields space-y-4 p-5 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl border-2 border-purple-200">
       <div class="flex items-center gap-2 mb-3">
        <span class="text-xl">‚ú®</span>
        <h3 class="font-semibold text-purple-700">Info Tambahan Netflix/Vidio</h3>
       </div>
       <div>
        <label class="block text-sm font-medium text-gray-600 mb-1.5"> <span class="cute-icon">‡≠®‡ßé ‚ãÜÔΩ°</span>Tgl Order </label> <input type="date" id="tgl-order" class="w-full px-4 py-2.5 rounded-xl border-2 border-purple-200 input-focus focus:border-purple-500 outline-none transition-all">
       </div>
       <div>
        <label class="block text-sm font-medium text-gray-600 mb-1.5"> <span class="cute-icon">‡≠®‡ßé ‚ãÜÔΩ°</span>Nomor Aktif </label> <input type="tel" id="nomor-aktif" placeholder="08xxxxxxxxxx" class="w-full px-4 py-2.5 rounded-xl border-2 border-purple-200 input-focus focus:border-purple-500 outline-none transition-all">
       </div>
       <div>
        <label class="block text-sm font-medium text-gray-600 mb-1.5"> <span class="cute-icon">‡≠®‡ßé ‚ãÜÔΩ°</span>Durasi </label> <input type="text" id="durasi-extra" placeholder="Contoh: 1 bulan" class="w-full px-4 py-2.5 rounded-xl border-2 border-purple-200 input-focus focus:border-purple-500 outline-none transition-all">
       </div>
       <div>
        <label class="block text-sm font-medium text-gray-600 mb-1.5"> <span class="cute-icon">‡≠®‡ßé ‚ãÜÔΩ°</span>Tipe App [1u/2u/priv/dll] </label> <input type="text" id="tipe-app" placeholder="Contoh: 1u, 2u, priv" class="w-full px-4 py-2.5 rounded-xl border-2 border-purple-200 input-focus focus:border-purple-500 outline-none transition-all">
       </div>
       <div>
        <label class="block text-sm font-medium text-gray-600 mb-1.5"> <span class="cute-icon">‡≠®‡ßé ‚ãÜÔΩ°</span>Merk Device </label> <input type="text" id="merk-device" placeholder="Contoh: Samsung, iPhone, Xiaomi" class="w-full px-4 py-2.5 rounded-xl border-2 border-purple-200 input-focus focus:border-purple-500 outline-none transition-all">
       </div>
       <div>
        <label class="block text-sm font-medium text-gray-600 mb-1.5"> <span class="cute-icon">‡≠®‡ßé ‚ãÜÔΩ°</span>Lokasi Device </label> <input type="text" id="lokasi-device" placeholder="Contoh: Jakarta, Bandung" class="w-full px-4 py-2.5 rounded-xl border-2 border-purple-200 input-focus focus:border-purple-500 outline-none transition-all">
       </div>
      </div><!-- Submit Button --> <button type="submit" id="submit-btn" class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-200 flex items-center justify-center gap-2"> <span id="btn-text">Kirim Garansi</span> <span id="btn-loading" class="hidden">
        <svg class="animate-spin h-5 w-5" viewbox="0 0 24 24">
         <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg></span> </button>
     </form><!-- Success Message -->
     <div id="success-message" class="hidden mt-6 p-5 bg-green-50 rounded-2xl border-2 border-green-200 text-center">
      <div class="text-4xl mb-2">
       üéâ
      </div>
      <h3 class="font-bold text-green-700 text-lg">Garansi Berhasil Dikirim!</h3>
      <p class="text-green-600 text-sm mt-1">Data garansi kamu sudah tersimpan</p><button id="new-form-btn" class="mt-4 px-6 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors text-sm font-medium"> Isi Form Baru </button>
     </div>
    </div><!-- Footer -->
    <div class="text-center mt-6 text-white/70 text-sm">
     <p>¬© 2024 REMBOSTORE. All rights reserved.</p>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      form_title: 'FORM GARANSI REMBOSTORE',
      submit_button_text: 'Kirim Garansi',
      background_color: '#667eea',
      button_color: '#9333ea',
      card_color: '#ffffff',
      text_color: '#374151',
      accent_color: '#ec4899'
    };

    let currentData = [];
    let isSubmitting = false;

    // Element SDK initialization
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('form-title').textContent = config.form_title || defaultConfig.form_title;
          document.getElementById('btn-text').textContent = config.submit_button_text || defaultConfig.submit_button_text;
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (v) => window.elementSdk.setConfig({ background_color: v })
            },
            {
              get: () => config.card_color || defaultConfig.card_color,
              set: (v) => window.elementSdk.setConfig({ card_color: v })
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (v) => window.elementSdk.setConfig({ text_color: v })
            },
            {
              get: () => config.button_color || defaultConfig.button_color,
              set: (v) => window.elementSdk.setConfig({ button_color: v })
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (v) => window.elementSdk.setConfig({ accent_color: v })
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['form_title', config.form_title || defaultConfig.form_title],
          ['submit_button_text', config.submit_button_text || defaultConfig.submit_button_text]
        ])
      });
    }

    // Data SDK initialization
    const dataHandler = {
      onDataChanged(data) {
        currentData = data;
      }
    };

    // Form elements
    const form = document.getElementById('warranty-form');
    const jenisApkInput = document.getElementById('jenis-apk');
    const extraFields = document.getElementById('extra-fields');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = document.getElementById('btn-text');
    const btnLoading = document.getElementById('btn-loading');
    const successMessage = document.getElementById('success-message');
    const newFormBtn = document.getElementById('new-form-btn');

    // Check if Netflix or Vidio is typed
    jenisApkInput.addEventListener('input', (e) => {
      const value = e.target.value.toLowerCase();
      if (value.includes('netflix') || value.includes('vidio')) {
        extraFields.classList.remove('hidden');
        // Make extra fields required
        document.getElementById('tgl-order').required = true;
        document.getElementById('nomor-aktif').required = true;
        document.getElementById('durasi-extra').required = true;
        document.getElementById('tipe-app').required = true;
        document.getElementById('merk-device').required = true;
        document.getElementById('lokasi-device').required = true;
      } else {
        extraFields.classList.add('hidden');
        // Remove required from extra fields
        document.getElementById('tgl-order').required = false;
        document.getElementById('nomor-aktif').required = false;
        document.getElementById('durasi-extra').required = false;
        document.getElementById('tipe-app').required = false;
        document.getElementById('merk-device').required = false;
        document.getElementById('lokasi-device').required = false;
      }
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (isSubmitting) return;
      
      // Check data limit
      if (currentData.length >= 999) {
        showInlineError('Batas maksimum 999 data tercapai. Hapus beberapa data terlebih dahulu.');
        return;
      }

      isSubmitting = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');
      submitBtn.disabled = true;

      const jenisApk = document.getElementById('jenis-apk').value;
      const isNetflixVidio = jenisApk.toLowerCase().includes('netflix') || jenisApk.toLowerCase().includes('vidio');

      const formData = {
        tanggal_pembelian: document.getElementById('tanggal-pembelian').value,
        durasi_pembelian: document.getElementById('durasi-pembelian').value,
        jenis_apk: jenisApk,
        tgl_order: isNetflixVidio ? document.getElementById('tgl-order').value : '',
        nomor_aktif: isNetflixVidio ? document.getElementById('nomor-aktif').value : '',
        durasi_extra: isNetflixVidio ? document.getElementById('durasi-extra').value : '',
        tipe_app: isNetflixVidio ? document.getElementById('tipe-app').value : '',
        merk_device: isNetflixVidio ? document.getElementById('merk-device').value : '',
        lokasi_device: isNetflixVidio ? document.getElementById('lokasi-device').value : '',
        created_at: new Date().toISOString()
      };

try {
  const response = await fetch("https://script.google.com/macros/s/AKfycbzmlIIa5rEnsEE3sqDgdNjVOt0rY4EgGn233NrDmpBdYl1elXMWTjh9ckOujwRdqKKZAQ/exec", {
    method: "POST",
    body: JSON.stringify(formData),
    headers: {
      "Content-Type": "application/json"
    }
  });

  const result = await response.json();

  if (result.status === "success") {
    form.classList.add('hidden');
    successMessage.classList.remove('hidden');
  } else {
    showInlineError('Gagal menyimpan data.');
  }

} catch (error) {
  showInlineError('Terjadi kesalahan koneksi.');
}
        
        if (result.isOk) {
          form.classList.add('hidden');
          successMessage.classList.remove('hidden');
        } else {
          showInlineError('Gagal menyimpan data. Silakan coba lagi.');
        }
      }

      isSubmitting = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
      submitBtn.disabled = false;
    });

    // New form button
    newFormBtn.addEventListener('click', () => {
      form.reset();
      extraFields.classList.add('hidden');
      form.classList.remove('hidden');
      successMessage.classList.add('hidden');
    });

    // Inline error message
    function showInlineError(message) {
      const existingError = document.getElementById('inline-error');
      if (existingError) existingError.remove();

      const errorDiv = document.createElement('div');
      errorDiv.id = 'inline-error';
      errorDiv.className = 'mt-4 p-4 bg-red-50 rounded-xl border-2 border-red-200 text-red-700 text-sm text-center';
      errorDiv.innerHTML = `<span class="mr-2">‚ö†Ô∏è</span>${message}`;
      form.appendChild(errorDiv);

      setTimeout(() => errorDiv.remove(), 5000);
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d42f5f681636cf4',t:'MTc3MjE0NTgwMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
